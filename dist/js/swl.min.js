function microAjax(t,e){if(this.bindFunction=function(t,e){return function(){return t.apply(e,[e])}},this.stateChange=function(){4==this.request.readyState&&this.callbackFunction(this.request.responseText)},this.getRequest=function(){return window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest?new XMLHttpRequest:!1},this.postBody=arguments[2]||"",this.callbackFunction=e,this.url=t,this.request=this.getRequest(),this.request){var r=this.request;r.onreadystatechange=this.bindFunction(this.stateChange,this),""!==this.postBody?(r.open("POST",t,!0),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.setRequestHeader("Connection","close")):r.open("GET",t,!0),r.send(this.postBody)}}angular.module("swl",["store","spotify","lastfm","lingua"]),angular.module("swl").config(["$routeProvider","$compileProvider",function(t,e){"use strict";t.when("/home",{templateUrl:"partials/home.html",controller:"LastFMCtrl"}).when("/news",{templateUrl:"partials/news.html",controller:"NewsCtrl"}).when("/albums",{templateUrl:"partials/albums.html",controller:"AlbumsCtrl"}).when("/settings",{templateUrl:"partials/settings.html",controller:"SettingsCtrl"}).otherwise({redirectTo:"/home"}),e.urlSanitizationWhitelist(/^\s*(https?|spotify):/)}]),angular.module("swl").value("swlSettings",{lastFMapiKey:"00198b31b392d0750f88819830e49680"}),angular.module("swl").run(["$rootScope","storeService","lsAdaptorService","rsService","remoteCheckService","linguaService",function(t,e,r,n,s,o){"use strict";if(console.log("swl.run"),e.local=r,e.remote=n,t._=o._,t._n=o._n,remoteStorage.receiveToken()){var i=remoteStorage.receiveToken();console.log("back from oauth, got token ",i),e.local.setItem("RS.token",i)}e.local.getItem("RS.token")&&s.checkForData()}]),angular.module("swl").controller("LastFMCtrl",["$scope","lastFMOnSpotifyService","storeService","artistAlbumModelService",function(t,e,r,n){"use strict";r.local.getItem("lastFMuserName")&&(t.lastFMuserName=r.local.getItem("lastFMuserName"),e.getSuggsOnSpot(t.lastFMuserName,function(e,r){t.suggs=e,t.onSpot=r})),t.setLastFMuserName=function(){r.local.setItem("lastFMuserName",t.lastFMuserName),e.getSuggsOnSpot(t.lastFMuserName,function(e,r){t.suggs=e,t.onSpot=r})},t.addArtistAlbum=function(t,e){console.log("add "+t+" - "+e),n.addArtistAlbum(t,e)}}]),angular.module("swl").controller("NewsCtrl",["$scope","artistNewsModelService",function(t,e){"use strict";t.artistNewsModel=e.artistNewsModel,e.populate(),t.addArtistNews=function(){var r=t.mAddArtistNews;e.addNews(r),console.log(t),t.mAddArtistNews=""},t.rm=function(t){e.rmNews(t)},t.addIgnore=function(t){e.addIgnore(t)}}]),angular.module("swl").controller("AlbumsCtrl",["$scope","artistAlbumModelService",function(t,e){"use strict";t.artistAlbumModel=e.artistAlbumModel,e.populate(),t.addArtistAlbum=function(){var r=t.mAddArtist,n=t.mAddAlbum;console.log("add "+r+" - "+n),e.addArtistAlbum(r,n),console.log(t),t.mAddArtist="",t.mAddAlbum=""},t.rm=function(t){e.rmArtistAlbum(t)}}]),angular.module("swl").controller("SettingsCtrl",["$scope","$rootScope","rsService","watchListService","statusService",function(t,e,r,n,s){"use strict";t.auth=function(){r.auth(t.mUserAddress)},t.exportData=angular.toJson(n.getData()),t.importData=function(){var e=t.mImport;try{e=JSON.parse(e),n.save(e),t.mImport="",s.add("info",_("import complete"))}catch(r){s.add("error",r.message)}},e.$on("dropFileEvent",function(e,r){console.log("got dropFileEvent",r),t.mImport=r,t.$apply()})}]),angular.module("swl").controller("navCtrl",["$scope","$location","$rootScope","spotifyService","artistNewsModelService",function(t,e,r,n,s){"use strict";t.isActive=function(t){return t===e.path()},r.$on("dropFromSpotifyEvent",function(e,r){var o=r.substring(r.lastIndexOf("/")+1);n.lookupArtist("spotify:artist:"+o,function(t){s.addNews(t)}),t.$apply()})}]),angular.module("swl").controller("StatusController",["$scope","statusService",function(t,e){"use strict";t.statuses=e.statuses}]),angular.module("swl").factory("watchListService",["storeService",function(t){"use strict";var e={data:{news:[],artistAlbums:[],ignoreReleaseList:[],updatedAt:{}},tSync:{},getData:function(){console.log("wls getData");var r=t.local.getItem("WL-data");return r&&(e.data=JSON.parse(r)),e.data},saveNews:function(t){var r=e.getData();r.news=t,e.save(r)},saveIgnoreReleaseList:function(t){var r=e.getData();r.ignoreReleaseList=t,e.save(r)},saveArtistAlbums:function(t){var r=e.getData();r.artistAlbums=t,e.save(r)},save:function(r){r.updatedAt=new Date,console.log("saving local",r),t.local.setItem("WL-data",angular.toJson(r)),console.log("save data remote"),t.local.getItem("RS.token")&&(e.tSync=window.setTimeout(function(){e.setRemote()},5e3))},dformat:function(t){t||(t=new Date);var e=t.getDate(),r=t.getMonth()+1,n=t.getFullYear();return 10>e&&(e="0"+e),10>r&&(r="0"+r),n+"-"+r+"-"+e},getRemote:function(e){t.remote.getItem(e)},setRemote:function(r){t.remote.setItem(angular.toJson(e.getData()),function(){console.log("remote updated");var n=e.getData();t.local.setItem("WL-data",angular.toJson(n)),r&&r()})}};return e}]),angular.module("swl").factory("artistNewsModelService",["linguaService","watchListService","spotifyService","lastFMService","statusService","swlSettings",function(t,e,r,n,s,o){"use strict";var i={artistNewsModel:{news:e.getData().news,ignoreReleaseList:e.getData().ignoreReleaseList,imgs:[],artistNewsFindings:[]},populate:function(){i.artistNewsModel.artistNewsFindings=[];for(var t=function(t,e){t&&t.length>0&&(i.artistNewsModel.artistNewsFindings[e-1].img=t)},e=function(e,r){if(e&&e.length>0){i.artistNewsModel.imgs[r]="img/spotify32bw.png";for(var s=0;e.length>s;s++)i.artistNewsModel.artistNewsFindings.push(e[s]),n.albumCover(o.lastFMapiKey,e[s].artist,e[s].album,t,i.artistNewsModel.artistNewsFindings.length)}else i.artistNewsModel.imgs[r]="img/delete-32.png"},s=0;i.artistNewsModel.news.length>s;s++)r.lookupNews(i.artistNewsModel.news[s].artist,e,s,i.artistNewsModel.ignoreReleaseList)},addNews:function(r){i.containsNews(r)?(console.log("duplicate, skipping ",r),s.add("error",t._("Skipping duplicate, %s is already in the list",r))):(i.artistNewsModel.news.push({artist:r,added:e.dformat()}),i.populate(),e.saveNews(i.artistNewsModel.news),s.add("info",t._("Added %s",r)))},rmNews:function(r){i.artistNewsModel.news.splice(r,1),i.populate(),e.saveNews(i.artistNewsModel.news),s.add("info",t._("Removed"))},addIgnore:function(t){i.artistNewsModel.ignoreReleaseList.push(t),i.populate(),e.saveIgnoreReleaseList(i.artistNewsModel.ignoreReleaseList)},containsNews:function(t){for(var e=i.artistNewsModel.news,r=0;e.length>r;r++)if(t.toLowerCase()==e[r].artist.toLowerCase())return!0;return!1}};return i}]),angular.module("swl").factory("artistAlbumModelService",["linguaService","watchListService","spotifyService","lastFMService","statusService","swlSettings",function(t,e,r,n,s,o){"use strict";var i={artistAlbumModel:{artistAlbums:e.getData().artistAlbums,imgs:[],artistAlbumsFindings:[]},populate:function(){i.artistAlbumModel.artistAlbumsFindings=[];for(var t=function(t,e){t&&t.length>0&&(i.artistAlbumModel.artistAlbumsFindings[e-1].img=t)},e=function(e,r,s,a,l){if(e&&e.length>0){i.artistAlbumModel.imgs[l]="img/spotify32bw.png";for(var u=0;e.length>u;u++)i.artistAlbumModel.artistAlbumsFindings.push(e[u]),n.albumCover(o.lastFMapiKey,e[u].artist,e[u].album,t,i.artistAlbumModel.artistAlbumsFindings.length)}else i.artistAlbumModel.imgs[l]="img/delete-32.png"},s=0;i.artistAlbumModel.artistAlbums.length>s;s++)r.lookupArtistAlbums(i.artistAlbumModel.artistAlbums[s].artist,i.artistAlbumModel.artistAlbums[s].album,"",e,s)},addArtistAlbum:function(r,n){i.containsArtistAlbum(r,n)?(console.log("duplicate, skipping ",r,n),s.add("error",t._("Skipping duplicate, %1$s %2$s is already in the list",[r,n]))):(i.artistAlbumModel.artistAlbums.push({artist:r,album:n,added:e.dformat()}),i.populate(),e.saveArtistAlbums(i.artistAlbumModel.artistAlbums),s.add("info",t._("Added %1$s - %2$s",[r,n])))},rmArtistAlbum:function(r){i.artistAlbumModel.artistAlbums.splice(r,1),i.populate(),e.saveArtistAlbums(i.artistAlbumModel.artistAlbums),s.add("info",t._("Removed"))},containsArtistAlbum:function(t,e){for(var r=i.artistAlbumModel.artistAlbums,n=0;r.length>n;n++)if(t.toLowerCase()==r[n].artist.toLowerCase()&&e.toLowerCase()==r[n].album.toLowerCase())return!0;return!1}};return i}]),angular.module("swl").factory("statusService",["$timeout",function(t){"use strict";var e={statuses:[],add:function(r,n){e.statuses.push({type:r,msg:n}),t(function(){console.log("timeout"),e.statuses.splice(0,1)},3e3)}};return e}]),angular.module("swl").factory("remoteCheckService",["linguaService","storeService","statusService","watchListService",function(t,e,r,n){"use strict";var s={checkForData:function(){e.remote.getItem(function(s,o){if(401==o)r.add("error",t._("Session expired, connect again: %s",o));else if(o)r.add("error",t._("Path not found %s",o));else if(s){s=JSON.parse(s),console.log("remote data",s);var i=Date.parse(s.updatedAt);console.log("remote date",s.updatedAt,i);var a=Date.parse(n.getData().updatedAt);isNaN(a)&&(a=0),console.log("local date",a),i>a&&(console.log("remote newer, updating"),e.local.setItem("WL-data",angular.toJson(s)))}else r.add("error",t._("No data available"))})}};return s}]),angular.module("swl").factory("lastFMOnSpotifyService",["lastFMService","spotifyService","swlSettings",function(t,e,r){"use strict";var n={getSuggsOnSpot:function(n,s){t.getNews(r.lastFMapiKey,n).then(function(t){for(var r=[],n=[],o=function(t,e,s,o){if(t.length>0)for(var i=0;t.length>i;i++)console.log("onSpot ",t[i].artist,t[i].album,t[i].img,t[i].href),r.push({artist:t[i].artist,album:t[i].album,href:t[i].href,img:t[i].img});else console.log("sugg",e,s,o),n.push({artist:e,album:s,img:o})},i=0;t.length>i;i++)e.lookupArtistAlbums(t[i].artist,t[i].album,t[i].image,o);s(n,r)})}};return n}]),angular.module("swl").directive("dropFileZone",["$rootScope",function(t){"use strict";function e(t){t.preventDefault(),t.stopPropagation()}function r(t){t.preventDefault(),t.stopPropagation()}function n(t){t.preventDefault(),t.stopPropagation(),console.log(t)}return{restrict:"A",link:function(s,o){o.bind("dragenter",function(t){e(t,o)}),o.bind("dragover",r),o.bind("drop",function(e){n(e,o);var r=e.dataTransfer.files,s=r[0];if(s){console.log("filename",s.name);var i=new FileReader;i.onload=function(e){var r=e.target.result;console.log("contents",r),t.$broadcast("dropFileEvent",r)},i.onerror=function(t){console.log(t)},i.readAsText(s)}})}}}]),angular.module("swl").directive("dropFromSpotify",["$rootScope",function(t){"use strict";function e(t){t.preventDefault(),t.stopPropagation()}function r(t){t.preventDefault(),t.stopPropagation()}function n(t){t.preventDefault(),t.stopPropagation()}return{restrict:"A",link:function(s,o){o.bind("dragenter",function(t){e(t,o)}),o.bind("dragover",r),o.bind("drop",function(e){n(e,o),t.$broadcast("dropFromSpotifyEvent",e.dataTransfer.getData("text"))})}}}]),angular.module("swl").directive("dragToFile",["watchListService",function(t){"use strict";return{restrict:"A",link:function(e,r){r.bind("click",function(){r[0].focus(),r[0].select()}),r.bind("dragstart",function(e){console.log("dragstart",r.val());var n=t.dformat();e.dataTransfer.setData("DownloadURL","text/plain; charset=UTF-8:WatchList.backup."+n+".txt:data:image/png;base64,"+btoa(unescape(encodeURIComponent(r.val()))))})}}}]),angular.module("store",[]),angular.module("store").factory("storeService",[function(){"use strict";var t={local:{getItem:function(){}},remote:{}};return t}]),angular.module("store").factory("lsAdaptorService",[function(){"use strict";return{getItem:function(t){return localStorage.getItem(t)},setItem:function(t,e){localStorage.setItem(t,e)},remove:function(t){localStorage.removeItem(t)}}}]),angular.module("store").factory("rsService",["storeService",function(t){"use strict";var e={key:t.local.getItem("RS.userAddress"),category:"music",auth:function(r){remoteStorage.getStorageInfo(r,function(n,s){if(n)console.log(n);else{e.key=r,t.local.setItem("RS.userAddress",r),t.local.setItem("RS.userStorageInfo",angular.toJson(s)),console.log("pathname "+location.pathname.substring(0,location.pathname.lastIndexOf("/")));var o=location.protocol+"//"+location.host+location.pathname.substring(0,location.pathname.lastIndexOf("/"));console.log("will open "+o+" for oauth dance");var i=remoteStorage.createOAuthAddress(s,[e.category+":rw"],o);console.log(i),location.href=i}})},getItem:function(r){var n=t.local.getItem("RS.token"),s=t.local.getItem("RS.userAddress");console.log("tryin remote get for "+s+" using token "+n);var o=JSON.parse(t.local.getItem("RS.userStorageInfo"));if(o){var i=remoteStorage.createClient(o,e.category+"/SWL",n);i.get(s,function(t,e){r(e,t)})}else r(null,"no storageInfo, connect again")},setItem:function(r,n){var s=t.local.getItem("RS.token"),o=t.local.getItem("RS.userAddress");console.log("tryin remote set for "+o+" using token "+s);var i=JSON.parse(t.local.getItem("RS.userStorageInfo")),a=remoteStorage.createClient(i,e.category+"/SWL",s);a.put(o,r,function(t){n(t)})}};return e}]),angular.module("spotify",[]),angular.module("spotify").factory("spotifyService",["$http",function(t){"use strict";var e={shouldMemoize:!0,newsMem:{},aaMem:{},userCountry:"SE",lookupArtistAlbums:function(r,n,s,o,i){var a={ar:r,al:n,img:s};e.shouldMemoize&&e.aaMem[r+"_"+n]?o(e.aaMem[r+"_"+n],r,n,s,i):t.get("http://ws.spotify.com/search/1/album.json?q="+n.replace(/&/g,"%26")+"%20AND%20artist:%22"+r.replace(/&/g,"%26")+"%22").success(function(t){var s=[];if(t.info.num_results>0)for(var l=0;t.albums.length>l;l++)t.albums[l].artists[0].name.toLowerCase()==r.toLowerCase()&&e.checkAvail(t.albums[l].availability.territories)&&s.push({artist:t.albums[l].artists[0].name,album:t.albums[l].name,href:t.albums[l].href,img:a.img});e.shouldMemoize&&(e.aaMem[r+"_"+n]=s),o(s,a.ar,a.al,a.img,i)})},lookupNews:function(r,n,s,o){e.shouldMemoize&&e.newsMem[r]?n(e.newsMem[r],s,o):t.get("http://ws.spotify.com/search/1/album.json?q=tag:new%20AND%20artist:%22"+r.replace(/&/g,"%26")+"%22").success(function(t){var i=[];if(t.info.num_results>0)for(var a=0;t.albums.length>a;a++)t.albums[a].artists[0].name.toLowerCase()==r.toLowerCase()&&e.checkAvail(t.albums[a].availability.territories)&&!e.shouldIgnore(o,t.albums[a].href)&&i.push({artist:t.albums[a].artists[0].name,album:t.albums[a].name,href:t.albums[a].href});e.shouldMemoize&&(e.newsMem[r]=i),n&&n(i,s,o)})},lookupArtist:function(e,r){t.get("http://ws.spotify.com/lookup/1/.json?uri="+e).success(function(t){t.artist?r(t.artist.name):t.album&&r(t.album.artist,t.album.name)}).error(function(t,e){console.log("fail",t,e)})},checkAvail:function(t){return t.indexOf(e.userCountry)>=0||"worldwide"==t},shouldIgnore:function(t,e){for(var r=0;t&&t.length>r;r++)if(e&&t[r].toLowerCase()==e.toLowerCase())return console.log("ignoring release "+e),!0;return!1}};return e}]),angular.module("lastfm",[]),angular.module("lastfm").factory("lastFMService",["$http","$q",function(t,e){"use strict";var r={getNews:function(r,n){var s=[],o=t.get("http://ws.audioscrobbler.com/2.0/?method=user.getnewreleases&format=json&userecs=1&user="+n+"&api_key="+r),i=t.get("http://ws.audioscrobbler.com/2.0/?method=user.getnewreleases&format=json&userecs=0&user="+n+"&api_key="+r),a=e.all([o,i]).then(function(t){for(var e=0;t.length>e;e++)for(var r=0;t[e].data.albums&&t[e].data.albums.album&&t[e].data.albums.album.length>r;r++)s.push({artist:t[e].data.albums.album[r].artist.name,album:t[e].data.albums.album[r].name,image:t[e].data.albums.album[r].image[2]["#text"]});return console.log(s),s});return console.log(a),a},albumCover:function(e,r,n,s,o){t.get("http://ws.audioscrobbler.com/2.0/?method=album.getInfo&format=json&artist="+r.replace(/&/g,"%26")+"&album="+n.replace(/&/g,"%26")+"&api_key="+e).success(function(t){var e={};e=t.album&&t.album.image[2]["#text"].length>0?t.album.image[2]["#text"]:"http://cdn.last.fm/flatness/catalogue/noimage/2/default_album_large.png",s&&s(e,o)})}};return r}]);var Lingua={init:function(t,e){"use strict";var r=localStorage.getItem("locale");if(console.log(r),r){var n=t.createElement("script");n.setAttribute("src","//code.angularjs.org/1.1.5/i18n/angular-locale_"+r+".js"),t.body.appendChild(n)}else r="en-us";microAjax("l_"+r+".json",function(t){t=JSON.parse(t);var n=new Jed({domain:r,missing_key_callback:function(t){console.error("Missing key "+t+" for "+r)},locale_data:t});console.log(n),window.i18n=n,e()})}};angular.module("lingua",[]),angular.module("lingua").factory("linguaService",function(){"use strict";var t={_:function(t,e){return i18n.translate(t).fetch(e)},_n:function(t,e,r,n){return r?i18n.translate(t).ifPlural(r,e).fetch(r):i18n.translate(t).fetch(n)}};return t}),angular.module("lingua").controller("linguaController",["$scope","$window",function(t,e){"use strict";t.changeLocale=function(t){localStorage.setItem("locale",t),e.location.reload()}}]),function(t,e){function r(t){return h.PF.compile(t||"nplurals=2; plural=(n != 1);")}function n(t,e){this._key=t,this._i18n=e}var s=Array.prototype,o=Object.prototype,i=s.slice,a=o.hasOwnProperty,l=s.forEach,u={},c={forEach:function(t,e,r){var n,s,o;if(null!==t)if(l&&t.forEach===l)t.forEach(e,r);else if(t.length===+t.length){for(n=0,s=t.length;s>n;n++)if(n in t&&e.call(r,t[n],n,t)===u)return}else for(o in t)if(a.call(t,o)&&e.call(r,t[o],o,t)===u)return},extend:function(t){return this.forEach(i.call(arguments,1),function(e){for(var r in e)t[r]=e[r]}),t}},h=function(t){if(this.defaults={locale_data:{messages:{"":{domain:"messages",lang:"en",plural_forms:"nplurals=2; plural=(n != 1);"}}},domain:"messages"},this.options=c.extend({},this.defaults,t),this.textdomain(this.options.domain),t.domain&&!this.options.locale_data[this.options.domain])throw Error("Text domain set to non-existent domain: `"+t.domain+"`")};h.context_delimiter=String.fromCharCode(4),c.extend(n.prototype,{onDomain:function(t){return this._domain=t,this},withContext:function(t){return this._context=t,this},ifPlural:function(t,e){return this._val=t,this._pkey=e,this},fetch:function(t){return"[object Array]"!={}.toString.call(t)&&(t=[].slice.call(arguments)),(t&&t.length?h.sprintf:function(t){return t})(this._i18n.dcnpgettext(this._domain,this._context,this._key,this._pkey,this._val),t)}}),c.extend(h.prototype,{translate:function(t){return new n(t,this)},textdomain:function(t){return t?(this._textdomain=t,void 0):this._textdomain},gettext:function(t){return this.dcnpgettext.call(this,e,e,t)},dgettext:function(t,r){return this.dcnpgettext.call(this,t,e,r)},dcgettext:function(t,r){return this.dcnpgettext.call(this,t,e,r)},ngettext:function(t,r,n){return this.dcnpgettext.call(this,e,e,t,r,n)},dngettext:function(t,r,n,s){return this.dcnpgettext.call(this,t,e,r,n,s)},dcngettext:function(t,r,n,s){return this.dcnpgettext.call(this,t,e,r,n,s)},pgettext:function(t,r){return this.dcnpgettext.call(this,e,t,r)},dpgettext:function(t,e,r){return this.dcnpgettext.call(this,t,e,r)},dcpgettext:function(t,e,r){return this.dcnpgettext.call(this,t,e,r)},npgettext:function(t,r,n,s){return this.dcnpgettext.call(this,e,t,r,n,s)},dnpgettext:function(t,e,r,n,s){return this.dcnpgettext.call(this,t,e,r,n,s)},dcnpgettext:function(t,e,n,s,o){s=s||n,t=t||this._textdomain,o=o===void 0?1:o;var i;if(!this.options)return i=new h,i.dcnpgettext.call(i,void 0,void 0,n,s,o);if(!this.options.locale_data)throw Error("No locale data provided.");if(!this.options.locale_data[t])throw Error("Domain `"+t+"` was not found.");if(!this.options.locale_data[t][""])throw Error("No locale meta information provided.");if(!n)throw Error("No translation key found.");if("number"!=typeof o&&(o=parseInt(o,10),isNaN(o)))throw Error("The number that was passed in is not a number.");var a,l,u=e?e+h.context_delimiter+n:n,c=this.options.locale_data,p=c[t],f=p[""].plural_forms||(c.messages||this.defaults.locale_data.messages)[""].plural_forms,d=r(f)(o)+1;if(!p)throw Error("No domain named `"+t+"` could be found.");return a=p[u],!a||d>=a.length?(this.options.missing_key_callback&&this.options.missing_key_callback(u),l=[null,n,s],l[r(f)(o)+1]):(l=a[d],l?l:(l=[null,n,s],l[r(f)(o)+1]))}});var p=function(){function t(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function e(t,e){for(var r=[];e>0;r[--e]=t);return r.join("")}var r=function(){return r.cache.hasOwnProperty(arguments[0])||(r.cache[arguments[0]]=r.parse(arguments[0])),r.format.call(null,r.cache[arguments[0]],arguments)};return r.format=function(r,n){var s,o,i,a,l,u,c,h=1,f=r.length,d="",g=[];for(o=0;f>o;o++)if(d=t(r[o]),"string"===d)g.push(r[o]);else if("array"===d){if(a=r[o],a[2])for(s=n[h],i=0;a[2].length>i;i++){if(!s.hasOwnProperty(a[2][i]))throw p('[sprintf] property "%s" does not exist',a[2][i]);s=s[a[2][i]]}else s=a[1]?n[a[1]]:n[h++];if(/[^s]/.test(a[8])&&"number"!=t(s))throw p("[sprintf] expecting number but found %s",t(s));switch((s===void 0||null===s)&&(s=""),a[8]){case"b":s=s.toString(2);break;case"c":s=String.fromCharCode(s);break;case"d":s=parseInt(s,10);break;case"e":s=a[7]?s.toExponential(a[7]):s.toExponential();break;case"f":s=a[7]?parseFloat(s).toFixed(a[7]):parseFloat(s);break;case"o":s=s.toString(8);break;case"s":s=(s+="")&&a[7]?s.substring(0,a[7]):s;break;case"u":s=Math.abs(s);break;case"x":s=s.toString(16);break;case"X":s=s.toString(16).toUpperCase()}s=/[def]/.test(a[8])&&a[3]&&s>=0?"+"+s:s,u=a[4]?"0"==a[4]?"0":a[4].charAt(1):" ",c=a[6]-(s+"").length,l=a[6]?e(u,c):"",g.push(a[5]?s+l:l+s)}return g.join("")},r.cache={},r.parse=function(t){for(var e=t,r=[],n=[],s=0;e;){if(null!==(r=/^[^\x25]+/.exec(e)))n.push(r[0]);else if(null!==(r=/^\x25{2}/.exec(e)))n.push("%");else{if(null===(r=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(e)))throw"[sprintf] huh?";if(r[2]){s|=1;var o=[],i=r[2],a=[];if(null===(a=/^([a-z_][a-z_\d]*)/i.exec(i)))throw"[sprintf] huh?";for(o.push(a[1]);""!==(i=i.substring(a[0].length));)if(null!==(a=/^\.([a-z_][a-z_\d]*)/i.exec(i)))o.push(a[1]);else{if(null===(a=/^\[(\d+)\]/.exec(i)))throw"[sprintf] huh?";o.push(a[1])}r[2]=o}else s|=2;if(3===s)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";n.push(r)}e=e.substring(r[0].length)}return n},r}(),f=function(t,e){return e.unshift(t),p.apply(null,e)};h.parse_plural=function(t,e){return t=t.replace(/n/g,e),h.parse_expression(t)},h.sprintf=function(t,e){return"[object Array]"=={}.toString.call(e)?f(t,[].slice.call(e)):p.apply(this,[].slice.call(arguments))},h.prototype.sprintf=function(){return h.sprintf.apply(this,arguments)},h.PF={},h.PF.parse=function(t){var e=h.PF.extractPluralExpr(t);return h.PF.parser.parse.call(h.PF.parser,e)},h.PF.compile=function(t){function e(t){return t===!0?1:t?t:0}var r=h.PF.parse(t);return function(t){return e(h.PF.interpreter(r)(t))}},h.PF.interpreter=function(t){return function(e){switch(t.type){case"GROUP":return h.PF.interpreter(t.expr)(e);case"TERNARY":return h.PF.interpreter(t.expr)(e)?h.PF.interpreter(t.truthy)(e):h.PF.interpreter(t.falsey)(e);case"OR":return h.PF.interpreter(t.left)(e)||h.PF.interpreter(t.right)(e);case"AND":return h.PF.interpreter(t.left)(e)&&h.PF.interpreter(t.right)(e);case"LT":return h.PF.interpreter(t.left)(e)<h.PF.interpreter(t.right)(e);case"GT":return h.PF.interpreter(t.left)(e)>h.PF.interpreter(t.right)(e);case"LTE":return h.PF.interpreter(t.left)(e)<=h.PF.interpreter(t.right)(e);case"GTE":return h.PF.interpreter(t.left)(e)>=h.PF.interpreter(t.right)(e);case"EQ":return h.PF.interpreter(t.left)(e)==h.PF.interpreter(t.right)(e);case"NEQ":return h.PF.interpreter(t.left)(e)!=h.PF.interpreter(t.right)(e);case"MOD":return h.PF.interpreter(t.left)(e)%h.PF.interpreter(t.right)(e);case"VAR":return e;case"NUM":return t.val;default:throw Error("Invalid Token found.")}}},h.PF.extractPluralExpr=function(t){t=t.replace(/^\s\s*/,"").replace(/\s\s*$/,""),/;\s*$/.test(t)||(t=t.concat(";"));var e,r=/nplurals\=(\d+);/,n=/plural\=(.*);/,s=t.match(r),o={};if(!(s.length>1))throw Error("nplurals not found in plural_forms string: "+t);if(o.nplurals=s[1],t=t.replace(r,""),e=t.match(n),!(e&&e.length>1))throw Error("`plural` expression not found: "+t);return e[1]},h.PF.parser=function(){var t={trace:function(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,"?":6,":":7,"||":8,"&&":9,"<":10,"<=":11,">":12,">=":13,"!=":14,"==":15,"%":16,"(":17,")":18,n:19,NUMBER:20,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"?",7:":",8:"||",9:"&&",10:"<",11:"<=",12:">",13:">=",14:"!=",15:"==",16:"%",17:"(",18:")",19:"n",20:"NUMBER"},productions_:[0,[3,2],[4,5],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1]],performAction:function(t,e,r,n,s,o){var i=o.length-1;switch(s){case 1:return{type:"GROUP",expr:o[i-1]};case 2:this.$={type:"TERNARY",expr:o[i-4],truthy:o[i-2],falsey:o[i]};break;case 3:this.$={type:"OR",left:o[i-2],right:o[i]};break;case 4:this.$={type:"AND",left:o[i-2],right:o[i]};break;case 5:this.$={type:"LT",left:o[i-2],right:o[i]};break;case 6:this.$={type:"LTE",left:o[i-2],right:o[i]};break;case 7:this.$={type:"GT",left:o[i-2],right:o[i]};break;case 8:this.$={type:"GTE",left:o[i-2],right:o[i]};break;case 9:this.$={type:"NEQ",left:o[i-2],right:o[i]};break;case 10:this.$={type:"EQ",left:o[i-2],right:o[i]};break;case 11:this.$={type:"MOD",left:o[i-2],right:o[i]};break;case 12:this.$={type:"GROUP",expr:o[i-1]};break;case 13:this.$={type:"VAR"};break;case 14:this.$={type:"NUM",val:Number(t)}}},table:[{3:1,4:2,17:[1,3],19:[1,4],20:[1,5]},{1:[3]},{5:[1,6],6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{4:17,17:[1,3],19:[1,4],20:[1,5]},{5:[2,13],6:[2,13],7:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],18:[2,13]},{5:[2,14],6:[2,14],7:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],18:[2,14]},{1:[2,1]},{4:18,17:[1,3],19:[1,4],20:[1,5]},{4:19,17:[1,3],19:[1,4],20:[1,5]},{4:20,17:[1,3],19:[1,4],20:[1,5]},{4:21,17:[1,3],19:[1,4],20:[1,5]},{4:22,17:[1,3],19:[1,4],20:[1,5]},{4:23,17:[1,3],19:[1,4],20:[1,5]},{4:24,17:[1,3],19:[1,4],20:[1,5]},{4:25,17:[1,3],19:[1,4],20:[1,5]},{4:26,17:[1,3],19:[1,4],20:[1,5]},{4:27,17:[1,3],19:[1,4],20:[1,5]},{6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[1,28]},{6:[1,7],7:[1,29],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{5:[2,3],6:[2,3],7:[2,3],8:[2,3],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,3]},{5:[2,4],6:[2,4],7:[2,4],8:[2,4],9:[2,4],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,4]},{5:[2,5],6:[2,5],7:[2,5],8:[2,5],9:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],14:[2,5],15:[2,5],16:[1,16],18:[2,5]},{5:[2,6],6:[2,6],7:[2,6],8:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],14:[2,6],15:[2,6],16:[1,16],18:[2,6]},{5:[2,7],6:[2,7],7:[2,7],8:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],14:[2,7],15:[2,7],16:[1,16],18:[2,7]},{5:[2,8],6:[2,8],7:[2,8],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[2,8],16:[1,16],18:[2,8]},{5:[2,9],6:[2,9],7:[2,9],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[1,16],18:[2,9]},{5:[2,10],6:[2,10],7:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[1,16],18:[2,10]},{5:[2,11],6:[2,11],7:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],18:[2,11]},{5:[2,12],6:[2,12],7:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],18:[2,12]},{4:30,17:[1,3],19:[1,4],20:[1,5]},{5:[2,2],6:[1,7],7:[2,2],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,2]}],defaultActions:{6:[2,1]},parseError:function(t){throw Error(t)},parse:function(t){function e(t){s.length=s.length-2*t,o.length=o.length-t,i.length=i.length-t}function r(){var t;return t=n.lexer.lex()||1,"number"!=typeof t&&(t=n.symbols_[t]||t),t}var n=this,s=[0],o=[null],i=[],a=this.table,l="",u=0,c=0,h=0,p=2,f=1;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.lexer.yylloc===void 0&&(this.lexer.yylloc={});var d=this.lexer.yylloc;i.push(d),"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var g,m,v,y,b,w,S,A,x,_={};;){if(v=s[s.length-1],this.defaultActions[v]?y=this.defaultActions[v]:(null==g&&(g=r()),y=a[v]&&a[v][g]),y===void 0||!y.length||!y[0]){if(!h){x=[];for(w in a[v])this.terminals_[w]&&w>2&&x.push("'"+this.terminals_[w]+"'");var k="";k=this.lexer.showPosition?"Parse error on line "+(u+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+x.join(", ")+", got '"+this.terminals_[g]+"'":"Parse error on line "+(u+1)+": Unexpected "+(1==g?"end of input":"'"+(this.terminals_[g]||g)+"'"),this.parseError(k,{text:this.lexer.match,token:this.terminals_[g]||g,line:this.lexer.yylineno,loc:d,expected:x})}if(3==h){if(g==f)throw Error(k||"Parsing halted.");c=this.lexer.yyleng,l=this.lexer.yytext,u=this.lexer.yylineno,d=this.lexer.yylloc,g=r()}for(;;){if(""+p in a[v])break;if(0==v)throw Error(k||"Parsing halted.");e(1),v=s[s.length-1]}m=g,g=p,v=s[s.length-1],y=a[v]&&a[v][p],h=3}if(y[0]instanceof Array&&y.length>1)throw Error("Parse Error: multiple actions possible at state: "+v+", token: "+g);switch(y[0]){case 1:s.push(g),o.push(this.lexer.yytext),i.push(this.lexer.yylloc),s.push(y[1]),g=null,m?(g=m,m=null):(c=this.lexer.yyleng,l=this.lexer.yytext,u=this.lexer.yylineno,d=this.lexer.yylloc,h>0&&h--);break;case 2:if(S=this.productions_[y[1]][1],_.$=o[o.length-S],_._$={first_line:i[i.length-(S||1)].first_line,last_line:i[i.length-1].last_line,first_column:i[i.length-(S||1)].first_column,last_column:i[i.length-1].last_column},b=this.performAction.call(_,l,c,u,this.yy,y[1],o,i),b!==void 0)return b;S&&(s=s.slice(0,2*-1*S),o=o.slice(0,-1*S),i=i.slice(0,-1*S)),s.push(this.productions_[y[1]][0]),o.push(_.$),i.push(_._$),A=a[s[s.length-2]][s[s.length-1]],s.push(A);break;case 3:return!0}}return!0}},e=function(){var t={EOF:1,parseError:function(t,e){if(!this.yy.parseError)throw Error(t);this.yy.parseError(t,e)},setInput:function(t){return this._input=t,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var t=this._input[0];this.yytext+=t,this.yyleng++,this.match+=t,this.matched+=t;var e=t.match(/\n/);return e&&this.yylineno++,this._input=this._input.slice(1),t},unput:function(t){return this._input=t+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return 20>t.length&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var t,e,r;this._more||(this.yytext="",this.match="");for(var n=this._currentRules(),s=0;n.length>s;s++)if(e=this._input.match(this.rules[n[s]]))return r=e[0].match(/\n.*/g),r&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-1:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],t=this.performAction.call(this,this.yy,this,n[s],this.conditionStack[this.conditionStack.length-1]),t?t:void 0;
return""===this._input?this.EOF:(this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno}),void 0)},lex:function(){var t=this.next();return t!==void 0?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)}};return t.performAction=function(t,e,r,n){switch(r){case 0:break;case 1:return 20;case 2:return 19;case 3:return 8;case 4:return 9;case 5:return 6;case 6:return 7;case 7:return 11;case 8:return 13;case 9:return 10;case 10:return 12;case 11:return 14;case 12:return 15;case 13:return 16;case 14:return 17;case 15:return 18;case 16:return 5;case 17:return"INVALID"}},t.rules=[/^\s+/,/^[0-9]+(\.[0-9]+)?\b/,/^n\b/,/^\|\|/,/^&&/,/^\?/,/^:/,/^<=/,/^>=/,/^</,/^>/,/^!=/,/^==/,/^%/,/^\(/,/^\)/,/^$/,/^./],t.conditions={INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],inclusive:!0}},t}();return t.lexer=e,t}(),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=h),exports.Jed=h):("function"==typeof define&&define.amd&&define("jed",function(){return h}),t.Jed=h)}(this);