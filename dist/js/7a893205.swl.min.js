function microAjax(a,b){if(this.bindFunction=function(a,b){return function(){return a.apply(b,[b])}},this.stateChange=function(){4==this.request.readyState&&this.callbackFunction(this.request.responseText)},this.getRequest=function(){return window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest?new XMLHttpRequest:!1},this.postBody=arguments[2]||"",this.callbackFunction=b,this.url=a,this.request=this.getRequest(),this.request){var c=this.request;c.onreadystatechange=this.bindFunction(this.stateChange,this),""!==this.postBody?(c.open("POST",a,!0),c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.setRequestHeader("Connection","close")):c.open("GET",a,!0),c.send(this.postBody)}}angular.module("swl",["store","spotify","lastfm","lingua"]),angular.module("swl").config(["$routeProvider","$compileProvider",function(a,b){"use strict";a.when("/home",{templateUrl:"partials/home.html",controller:"LastFMCtrl"}).when("/news",{templateUrl:"partials/news.html",controller:"NewsCtrl"}).when("/albums",{templateUrl:"partials/albums.html",controller:"AlbumsCtrl"}).when("/settings",{templateUrl:"partials/settings.html",controller:"SettingsCtrl"}).otherwise({redirectTo:"/home"}),b.urlSanitizationWhitelist(/^\s*(https?|spotify):/)}]),angular.module("swl").value("swlSettings",{lastFMapiKey:"00198b31b392d0750f88819830e49680"}),angular.module("swl").run(["$rootScope","storeService","lsAdaptorService","rsService","remoteCheckService","linguaService",function(a,b,c,d,e,f){"use strict";if(console.log("swl.run"),b.local=c,b.remote=d,a._=f._,a._n=f._n,remoteStorage.receiveToken()){var g=remoteStorage.receiveToken();console.log("back from oauth, got token ",g),b.local.setItem("RS.token",g)}b.local.getItem("RS.token")&&e.checkForData()}]),angular.module("swl").controller("LastFMCtrl",["$scope","lastFMOnSpotifyService","storeService","artistAlbumModelService",function(a,b,c,d){"use strict";c.local.getItem("lastFMuserName")&&(a.lastFMuserName=c.local.getItem("lastFMuserName"),b.getSuggsOnSpot(a.lastFMuserName,function(b,c){a.suggs=b,a.onSpot=c})),a.setLastFMuserName=function(){c.local.setItem("lastFMuserName",a.lastFMuserName),b.getSuggsOnSpot(a.lastFMuserName,function(b,c){a.suggs=b,a.onSpot=c})},a.addArtistAlbum=function(a,b){console.log("add "+a+" - "+b),d.addArtistAlbum(a,b)}}]),angular.module("swl").controller("NewsCtrl",["$scope","artistNewsModelService",function(a,b){"use strict";a.artistNewsModel=b.artistNewsModel,b.populate(),a.addArtistNews=function(){var c=a.mAddArtistNews;b.addNews(c),console.log(a),a.mAddArtistNews=""},a.rm=function(a){b.rmNews(a)},a.addIgnore=function(a){b.addIgnore(a)}}]),angular.module("swl").controller("AlbumsCtrl",["$scope","artistAlbumModelService",function(a,b){"use strict";a.artistAlbumModel=b.artistAlbumModel,b.populate(),a.addArtistAlbum=function(){var c=a.mAddArtist,d=a.mAddAlbum;console.log("add "+c+" - "+d),b.addArtistAlbum(c,d),console.log(a),a.mAddArtist="",a.mAddAlbum=""},a.rm=function(a){b.rmArtistAlbum(a)}}]),angular.module("swl").controller("SettingsCtrl",["$scope","$rootScope","rsService","watchListService","statusService",function(a,b,c,d,e){"use strict";a.auth=function(){c.auth(a.mUserAddress)},a.exportData=angular.toJson(d.getData()),a.importData=function(){var b=a.mImport;try{b=JSON.parse(b),d.save(b),a.mImport="",e.add("info",a._("import complete"))}catch(c){e.add("error",c.message)}},b.$on("dropFileEvent",function(b,c){console.log("got dropFileEvent",c),a.mImport=c,a.$apply()})}]),angular.module("swl").controller("navCtrl",["$scope","$location","$rootScope","spotifyService","artistNewsModelService",function(a,b,c,d,e){"use strict";a.isActive=function(a){return a===b.path()},c.$on("dropFromSpotifyEvent",function(b,c){var f=c.substring(c.lastIndexOf("/")+1);d.lookupArtist("spotify:artist:"+f,function(a){e.addNews(a)}),a.$apply()})}]),angular.module("swl").controller("StatusController",["$scope","statusService",function(a,b){"use strict";a.statuses=b.statuses}]),angular.module("swl").factory("watchListService",["storeService",function(a){"use strict";var b={data:{news:[],artistAlbums:[],ignoreReleaseList:[],updatedAt:{}},tSync:{},getData:function(){console.log("wls getData");var c=a.local.getItem("WL-data");return c&&(b.data=JSON.parse(c)),b.data},saveNews:function(a){var c=b.getData();c.news=a,b.save(c)},saveIgnoreReleaseList:function(a){var c=b.getData();c.ignoreReleaseList=a,b.save(c)},saveArtistAlbums:function(a){var c=b.getData();c.artistAlbums=a,b.save(c)},save:function(c){c.updatedAt=new Date,console.log("saving local",c),a.local.setItem("WL-data",angular.toJson(c)),console.log("save data remote"),a.local.getItem("RS.token")&&(b.tSync=window.setTimeout(function(){b.setRemote()},5e3))},dformat:function(a){a||(a=new Date);var b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear();return 10>b&&(b="0"+b),10>c&&(c="0"+c),d+"-"+c+"-"+b},getRemote:function(b){a.remote.getItem(b)},setRemote:function(c){a.remote.setItem(angular.toJson(b.getData()),function(){console.log("remote updated");var d=b.getData();a.local.setItem("WL-data",angular.toJson(d)),c&&c()})}};return b}]),angular.module("swl").factory("artistNewsModelService",["linguaService","watchListService","spotifyService","lastFMService","statusService","swlSettings",function(a,b,c,d,e,f){"use strict";var g={artistNewsModel:{news:b.getData().news,ignoreReleaseList:b.getData().ignoreReleaseList,imgs:[],artistNewsFindings:[]},populate:function(){g.artistNewsModel.artistNewsFindings=[];for(var a=function(a,b){a&&a.length>0&&(g.artistNewsModel.artistNewsFindings[b-1].img=a)},b=function(b,c){if(b&&b.length>0){g.artistNewsModel.imgs[c]="img/spotify32bw.png";for(var e=0;e<b.length;e++)g.artistNewsModel.artistNewsFindings.push(b[e]),d.albumCover(f.lastFMapiKey,b[e].artist,b[e].album,a,g.artistNewsModel.artistNewsFindings.length)}else g.artistNewsModel.imgs[c]="img/delete-32.png"},e=0;e<g.artistNewsModel.news.length;e++)c.lookupNews(g.artistNewsModel.news[e].artist,b,e,g.artistNewsModel.ignoreReleaseList)},addNews:function(c){g.containsNews(c)?(console.log("duplicate, skipping ",c),e.add("error",a._("Skipping duplicate, %s is already in the list",c))):(g.artistNewsModel.news.push({artist:c,added:b.dformat()}),g.populate(),b.saveNews(g.artistNewsModel.news),e.add("info",a._("Added %s",c)))},rmNews:function(c){g.artistNewsModel.news.splice(c,1),g.populate(),b.saveNews(g.artistNewsModel.news),e.add("info",a._("Removed"))},addIgnore:function(a){g.artistNewsModel.ignoreReleaseList.push(a),g.populate(),b.saveIgnoreReleaseList(g.artistNewsModel.ignoreReleaseList)},containsNews:function(a){for(var b=g.artistNewsModel.news,c=0;c<b.length;c++)if(a.toLowerCase()==b[c].artist.toLowerCase())return!0;return!1}};return g}]),angular.module("swl").factory("artistAlbumModelService",["linguaService","watchListService","spotifyService","lastFMService","statusService","swlSettings",function(a,b,c,d,e,f){"use strict";var g={artistAlbumModel:{artistAlbums:b.getData().artistAlbums,imgs:[],artistAlbumsFindings:[]},populate:function(){g.artistAlbumModel.artistAlbumsFindings=[];for(var a=function(a,b){a&&a.length>0&&(g.artistAlbumModel.artistAlbumsFindings[b-1].img=a)},b=function(b,c,e,h,i){if(b&&b.length>0){g.artistAlbumModel.imgs[i]="img/spotify32bw.png";for(var j=0;j<b.length;j++)g.artistAlbumModel.artistAlbumsFindings.push(b[j]),d.albumCover(f.lastFMapiKey,b[j].artist,b[j].album,a,g.artistAlbumModel.artistAlbumsFindings.length)}else g.artistAlbumModel.imgs[i]="img/delete-32.png"},e=0;e<g.artistAlbumModel.artistAlbums.length;e++)c.lookupArtistAlbums(g.artistAlbumModel.artistAlbums[e].artist,g.artistAlbumModel.artistAlbums[e].album,"",b,e)},addArtistAlbum:function(c,d){g.containsArtistAlbum(c,d)?(console.log("duplicate, skipping ",c,d),e.add("error",a._("Skipping duplicate, %1$s %2$s is already in the list",[c,d]))):(g.artistAlbumModel.artistAlbums.push({artist:c,album:d,added:b.dformat()}),g.populate(),b.saveArtistAlbums(g.artistAlbumModel.artistAlbums),e.add("info",a._("Added %1$s - %2$s",[c,d])))},rmArtistAlbum:function(c){g.artistAlbumModel.artistAlbums.splice(c,1),g.populate(),b.saveArtistAlbums(g.artistAlbumModel.artistAlbums),e.add("info",a._("Removed"))},containsArtistAlbum:function(a,b){for(var c=g.artistAlbumModel.artistAlbums,d=0;d<c.length;d++)if(a.toLowerCase()==c[d].artist.toLowerCase()&&b.toLowerCase()==c[d].album.toLowerCase())return!0;return!1}};return g}]),angular.module("swl").factory("statusService",["$timeout",function(a){"use strict";var b={statuses:[],add:function(c,d){b.statuses.push({type:c,msg:d}),a(function(){console.log("timeout"),b.statuses.splice(0,1)},3e3)}};return b}]),angular.module("swl").factory("remoteCheckService",["linguaService","storeService","statusService","watchListService",function(a,b,c,d){"use strict";var e={checkForData:function(){b.remote.getItem(function(e,f){if(401==f)c.add("error",a._("Session expired, connect again: %s",f));else if(f)c.add("error",a._("Path not found %s",f));else if(e){e=JSON.parse(e),console.log("remote data",e);var g=Date.parse(e.updatedAt);console.log("remote date",e.updatedAt,g);var h=Date.parse(d.getData().updatedAt);isNaN(h)&&(h=0),console.log("local date",h),g>h&&(console.log("remote newer, updating"),b.local.setItem("WL-data",angular.toJson(e)))}else c.add("error",a._("No data available"))})}};return e}]),angular.module("swl").factory("lastFMOnSpotifyService",["lastFMService","spotifyService","swlSettings",function(a,b,c){"use strict";var d={getSuggsOnSpot:function(d,e){a.getNews(c.lastFMapiKey,d).then(function(a){for(var c=[],d=[],f=function(a,b,e,f){if(a.length>0)for(var g=0;g<a.length;g++)console.log("onSpot ",a[g].artist,a[g].album,a[g].img,a[g].href),c.push({artist:a[g].artist,album:a[g].album,href:a[g].href,img:a[g].img});else console.log("sugg",b,e,f),d.push({artist:b,album:e,img:f})},g=0;g<a.length;g++)b.lookupArtistAlbums(a[g].artist,a[g].album,a[g].image,f);e(d,c)})}};return d}]),angular.module("swl").directive("dropFileZone",["$rootScope",function(a){"use strict";function b(a){a.preventDefault(),a.stopPropagation()}function c(a){a.preventDefault(),a.stopPropagation()}function d(a){a.preventDefault(),a.stopPropagation(),console.log(a)}return{restrict:"A",link:function(e,f){f.bind("dragenter",function(a){b(a,f)}),f.bind("dragover",c),f.bind("drop",function(b){d(b,f);var c=b.dataTransfer.files,e=c[0];if(e){console.log("filename",e.name);var g=new FileReader;g.onload=function(b){var c=b.target.result;console.log("contents",c),a.$broadcast("dropFileEvent",c)},g.onerror=function(a){console.log(a)},g.readAsText(e)}})}}}]),angular.module("swl").directive("dropFromSpotify",["$rootScope",function(a){"use strict";function b(a){a.preventDefault(),a.stopPropagation()}function c(a){a.preventDefault(),a.stopPropagation()}function d(a){a.preventDefault(),a.stopPropagation()}return{restrict:"A",link:function(e,f){f.bind("dragenter",function(a){b(a,f)}),f.bind("dragover",c),f.bind("drop",function(b){d(b,f),a.$broadcast("dropFromSpotifyEvent",b.dataTransfer.getData("text"))})}}}]),angular.module("swl").directive("dragToFile",["watchListService",function(a){"use strict";return{restrict:"A",link:function(b,c){c.bind("click",function(){c[0].focus(),c[0].select()}),c.bind("dragstart",function(b){console.log("dragstart",c.val());var d=a.dformat();b.dataTransfer.setData("DownloadURL","text/plain; charset=UTF-8:WatchList.backup."+d+".txt:data:image/png;base64,"+btoa(unescape(encodeURIComponent(c.val()))))})}}}]),angular.module("store",[]),angular.module("store").factory("storeService",[function(){"use strict";var a={local:{getItem:function(){}},remote:{}};return a}]),angular.module("store").factory("lsAdaptorService",[function(){"use strict";return{getItem:function(a){return localStorage.getItem(a)},setItem:function(a,b){localStorage.setItem(a,b)},remove:function(a){localStorage.removeItem(a)}}}]),angular.module("store").factory("rsService",["storeService",function(a){"use strict";var b={key:a.local.getItem("RS.userAddress"),category:"music",auth:function(c){remoteStorage.getStorageInfo(c,function(d,e){if(d)console.log(d);else{b.key=c,a.local.setItem("RS.userAddress",c),a.local.setItem("RS.userStorageInfo",angular.toJson(e)),console.log("pathname "+location.pathname.substring(0,location.pathname.lastIndexOf("/")));var f=location.protocol+"//"+location.host+location.pathname.substring(0,location.pathname.lastIndexOf("/"));console.log("will open "+f+" for oauth dance");var g=remoteStorage.createOAuthAddress(e,[b.category+":rw"],f);console.log(g),location.href=g}})},getItem:function(c){var d=a.local.getItem("RS.token"),e=a.local.getItem("RS.userAddress");console.log("tryin remote get for "+e+" using token "+d);var f=JSON.parse(a.local.getItem("RS.userStorageInfo"));if(f){var g=remoteStorage.createClient(f,b.category+"/SWL",d);g.get(e,function(a,b){c(b,a)})}else c(null,"no storageInfo, connect again")},setItem:function(c,d){var e=a.local.getItem("RS.token"),f=a.local.getItem("RS.userAddress");console.log("tryin remote set for "+f+" using token "+e);var g=JSON.parse(a.local.getItem("RS.userStorageInfo")),h=remoteStorage.createClient(g,b.category+"/SWL",e);h.put(f,c,function(a){d(a)})}};return b}]),angular.module("spotify",[]),angular.module("spotify").factory("spotifyService",["$http",function(a){"use strict";var b={shouldMemoize:!0,newsMem:{},aaMem:{},userCountry:"SE",lookupArtistAlbums:function(c,d,e,f,g){var h={ar:c,al:d,img:e};b.shouldMemoize&&b.aaMem[c+"_"+d]?f(b.aaMem[c+"_"+d],c,d,e,g):a.get("http://ws.spotify.com/search/1/album.json?q="+d.replace(/&/g,"%26")+"%20AND%20artist:%22"+c.replace(/&/g,"%26")+"%22").success(function(a){var e=[];if(a.info.num_results>0)for(var i=0;i<a.albums.length;i++)a.albums[i].artists[0].name.toLowerCase()==c.toLowerCase()&&b.checkAvail(a.albums[i].availability.territories)&&e.push({artist:a.albums[i].artists[0].name,album:a.albums[i].name,href:a.albums[i].href,img:h.img});b.shouldMemoize&&(b.aaMem[c+"_"+d]=e),f(e,h.ar,h.al,h.img,g)})},lookupNews:function(c,d,e,f){b.shouldMemoize&&b.newsMem[c]?d(b.newsMem[c],e,f):a.get("http://ws.spotify.com/search/1/album.json?q=tag:new%20AND%20artist:%22"+c.replace(/&/g,"%26")+"%22").success(function(a){var g=[];if(a.info.num_results>0)for(var h=0;h<a.albums.length;h++)a.albums[h].artists[0].name.toLowerCase()==c.toLowerCase()&&b.checkAvail(a.albums[h].availability.territories)&&!b.shouldIgnore(f,a.albums[h].href)&&g.push({artist:a.albums[h].artists[0].name,album:a.albums[h].name,href:a.albums[h].href});b.shouldMemoize&&(b.newsMem[c]=g),d&&d(g,e,f)})},lookupArtist:function(b,c){a.get("http://ws.spotify.com/lookup/1/.json?uri="+b).success(function(a){a.artist?c(a.artist.name):a.album&&c(a.album.artist,a.album.name)}).error(function(a,b){console.log("fail",a,b)})},checkAvail:function(a){return a.indexOf(b.userCountry)>=0||"worldwide"==a},shouldIgnore:function(a,b){for(var c=0;a&&c<a.length;c++)if(b&&a[c].toLowerCase()==b.toLowerCase())return console.log("ignoring release "+b),!0;return!1}};return b}]),angular.module("lastfm",[]),angular.module("lastfm").factory("lastFMService",["$http","$q",function(a,b){"use strict";var c={getNews:function(c,d){var e=[],f=a.get("http://ws.audioscrobbler.com/2.0/?method=user.getnewreleases&format=json&userecs=1&user="+d+"&api_key="+c),g=a.get("http://ws.audioscrobbler.com/2.0/?method=user.getnewreleases&format=json&userecs=0&user="+d+"&api_key="+c),h=b.all([f,g]).then(function(a){for(var b=0;b<a.length;b++)for(var c=0;a[b].data.albums&&a[b].data.albums.album&&c<a[b].data.albums.album.length;c++)e.push({artist:a[b].data.albums.album[c].artist.name,album:a[b].data.albums.album[c].name,image:a[b].data.albums.album[c].image[2]["#text"]});return console.log(e),e});return console.log(h),h},albumCover:function(b,c,d,e,f){a.get("http://ws.audioscrobbler.com/2.0/?method=album.getInfo&format=json&artist="+c.replace(/&/g,"%26")+"&album="+d.replace(/&/g,"%26")+"&api_key="+b).success(function(a){var b={};b=a.album&&a.album.image[2]["#text"].length>0?a.album.image[2]["#text"]:"http://cdn.last.fm/flatness/catalogue/noimage/2/default_album_large.png",e&&e(b,f)})}};return c}]);var Lingua={init:function(a,b){"use strict";var c=localStorage.getItem("locale");if(console.log(c),c){var d=a.createElement("script");d.setAttribute("src","//code.angularjs.org/1.1.5/i18n/angular-locale_"+c+".js"),a.body.appendChild(d)}else c="en-us";microAjax("l_"+c+".json",function(a){a=JSON.parse(a);var d=new Jed({domain:c,missing_key_callback:function(a){console.error("Missing key "+a+" for "+c)},locale_data:a});console.log(d),window.i18n=d,b()})}};angular.module("lingua",[]),angular.module("lingua").factory("linguaService",function(){"use strict";var a={_:function(a,b){return i18n.translate(a).fetch(b)},_n:function(a,b,c,d){return c?i18n.translate(a).ifPlural(c,b).fetch(c):i18n.translate(a).fetch(d)}};return a}),angular.module("lingua").controller("linguaController",["$scope","$window",function(a,b){"use strict";a.changeLocale=function(a){localStorage.setItem("locale",a),b.location.reload()}}]),function(a,b){function c(a){return l.PF.compile(a||"nplurals=2; plural=(n != 1);")}function d(a,b){this._key=a,this._i18n=b}var e=Array.prototype,f=Object.prototype,g=e.slice,h=f.hasOwnProperty,i=e.forEach,j={},k={forEach:function(a,b,c){var d,e,f;if(null!==a)if(i&&a.forEach===i)a.forEach(b,c);else if(a.length===+a.length){for(d=0,e=a.length;e>d;d++)if(d in a&&b.call(c,a[d],d,a)===j)return}else for(f in a)if(h.call(a,f)&&b.call(c,a[f],f,a)===j)return},extend:function(a){return this.forEach(g.call(arguments,1),function(b){for(var c in b)a[c]=b[c]}),a}},l=function(a){if(this.defaults={locale_data:{messages:{"":{domain:"messages",lang:"en",plural_forms:"nplurals=2; plural=(n != 1);"}}},domain:"messages"},this.options=k.extend({},this.defaults,a),this.textdomain(this.options.domain),a.domain&&!this.options.locale_data[this.options.domain])throw new Error("Text domain set to non-existent domain: `"+a.domain+"`")};l.context_delimiter=String.fromCharCode(4),k.extend(d.prototype,{onDomain:function(a){return this._domain=a,this},withContext:function(a){return this._context=a,this},ifPlural:function(a,b){return this._val=a,this._pkey=b,this},fetch:function(a){return"[object Array]"!={}.toString.call(a)&&(a=[].slice.call(arguments)),(a&&a.length?l.sprintf:function(a){return a})(this._i18n.dcnpgettext(this._domain,this._context,this._key,this._pkey,this._val),a)}}),k.extend(l.prototype,{translate:function(a){return new d(a,this)},textdomain:function(a){return a?(this._textdomain=a,void 0):this._textdomain},gettext:function(a){return this.dcnpgettext.call(this,b,b,a)},dgettext:function(a,c){return this.dcnpgettext.call(this,a,b,c)},dcgettext:function(a,c){return this.dcnpgettext.call(this,a,b,c)},ngettext:function(a,c,d){return this.dcnpgettext.call(this,b,b,a,c,d)},dngettext:function(a,c,d,e){return this.dcnpgettext.call(this,a,b,c,d,e)},dcngettext:function(a,c,d,e){return this.dcnpgettext.call(this,a,b,c,d,e)},pgettext:function(a,c){return this.dcnpgettext.call(this,b,a,c)},dpgettext:function(a,b,c){return this.dcnpgettext.call(this,a,b,c)},dcpgettext:function(a,b,c){return this.dcnpgettext.call(this,a,b,c)},npgettext:function(a,c,d,e){return this.dcnpgettext.call(this,b,a,c,d,e)},dnpgettext:function(a,b,c,d,e){return this.dcnpgettext.call(this,a,b,c,d,e)},dcnpgettext:function(a,b,d,e,f){e=e||d,a=a||this._textdomain,f="undefined"==typeof f?1:f;var g;if(!this.options)return g=new l,g.dcnpgettext.call(g,void 0,void 0,d,e,f);if(!this.options.locale_data)throw new Error("No locale data provided.");if(!this.options.locale_data[a])throw new Error("Domain `"+a+"` was not found.");if(!this.options.locale_data[a][""])throw new Error("No locale meta information provided.");if(!d)throw new Error("No translation key found.");if("number"!=typeof f&&(f=parseInt(f,10),isNaN(f)))throw new Error("The number that was passed in is not a number.");var h,i,j=b?b+l.context_delimiter+d:d,k=this.options.locale_data,m=k[a],n=m[""].plural_forms||(k.messages||this.defaults.locale_data.messages)[""].plural_forms,o=c(n)(f)+1;if(!m)throw new Error("No domain named `"+a+"` could be found.");return h=m[j],!h||o>=h.length?(this.options.missing_key_callback&&this.options.missing_key_callback(j),i=[null,d,e],i[c(n)(f)+1]):(i=h[o],i?i:(i=[null,d,e],i[c(n)(f)+1]))}});var m=function(){function a(a){return Object.prototype.toString.call(a).slice(8,-1).toLowerCase()}function b(a,b){for(var c=[];b>0;c[--b]=a);return c.join("")}var c=function(){return c.cache.hasOwnProperty(arguments[0])||(c.cache[arguments[0]]=c.parse(arguments[0])),c.format.call(null,c.cache[arguments[0]],arguments)};return c.format=function(c,d){var e,f,g,h,i,j,k,l=1,n=c.length,o="",p=[];for(f=0;n>f;f++)if(o=a(c[f]),"string"===o)p.push(c[f]);else if("array"===o){if(h=c[f],h[2])for(e=d[l],g=0;g<h[2].length;g++){if(!e.hasOwnProperty(h[2][g]))throw m('[sprintf] property "%s" does not exist',h[2][g]);e=e[h[2][g]]}else e=h[1]?d[h[1]]:d[l++];if(/[^s]/.test(h[8])&&"number"!=a(e))throw m("[sprintf] expecting number but found %s",a(e));switch(("undefined"==typeof e||null===e)&&(e=""),h[8]){case"b":e=e.toString(2);break;case"c":e=String.fromCharCode(e);break;case"d":e=parseInt(e,10);break;case"e":e=h[7]?e.toExponential(h[7]):e.toExponential();break;case"f":e=h[7]?parseFloat(e).toFixed(h[7]):parseFloat(e);break;case"o":e=e.toString(8);break;case"s":e=(e=String(e))&&h[7]?e.substring(0,h[7]):e;break;case"u":e=Math.abs(e);break;case"x":e=e.toString(16);break;case"X":e=e.toString(16).toUpperCase()}e=/[def]/.test(h[8])&&h[3]&&e>=0?"+"+e:e,j=h[4]?"0"==h[4]?"0":h[4].charAt(1):" ",k=h[6]-String(e).length,i=h[6]?b(j,k):"",p.push(h[5]?e+i:i+e)}return p.join("")},c.cache={},c.parse=function(a){for(var b=a,c=[],d=[],e=0;b;){if(null!==(c=/^[^\x25]+/.exec(b)))d.push(c[0]);else if(null!==(c=/^\x25{2}/.exec(b)))d.push("%");else{if(null===(c=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(b)))throw"[sprintf] huh?";if(c[2]){e|=1;var f=[],g=c[2],h=[];if(null===(h=/^([a-z_][a-z_\d]*)/i.exec(g)))throw"[sprintf] huh?";for(f.push(h[1]);""!==(g=g.substring(h[0].length));)if(null!==(h=/^\.([a-z_][a-z_\d]*)/i.exec(g)))f.push(h[1]);else{if(null===(h=/^\[(\d+)\]/.exec(g)))throw"[sprintf] huh?";f.push(h[1])}c[2]=f}else e|=2;if(3===e)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";d.push(c)}b=b.substring(c[0].length)}return d},c}(),n=function(a,b){return b.unshift(a),m.apply(null,b)};l.parse_plural=function(a,b){return a=a.replace(/n/g,b),l.parse_expression(a)},l.sprintf=function(a,b){return"[object Array]"=={}.toString.call(b)?n(a,[].slice.call(b)):m.apply(this,[].slice.call(arguments))},l.prototype.sprintf=function(){return l.sprintf.apply(this,arguments)},l.PF={},l.PF.parse=function(a){var b=l.PF.extractPluralExpr(a);return l.PF.parser.parse.call(l.PF.parser,b)},l.PF.compile=function(a){function b(a){return a===!0?1:a?a:0}var c=l.PF.parse(a);return function(a){return b(l.PF.interpreter(c)(a))}},l.PF.interpreter=function(a){return function(b){switch(a.type){case"GROUP":return l.PF.interpreter(a.expr)(b);case"TERNARY":return l.PF.interpreter(a.expr)(b)?l.PF.interpreter(a.truthy)(b):l.PF.interpreter(a.falsey)(b);case"OR":return l.PF.interpreter(a.left)(b)||l.PF.interpreter(a.right)(b);case"AND":return l.PF.interpreter(a.left)(b)&&l.PF.interpreter(a.right)(b);case"LT":return l.PF.interpreter(a.left)(b)<l.PF.interpreter(a.right)(b);case"GT":return l.PF.interpreter(a.left)(b)>l.PF.interpreter(a.right)(b);case"LTE":return l.PF.interpreter(a.left)(b)<=l.PF.interpreter(a.right)(b);case"GTE":return l.PF.interpreter(a.left)(b)>=l.PF.interpreter(a.right)(b);case"EQ":return l.PF.interpreter(a.left)(b)==l.PF.interpreter(a.right)(b);case"NEQ":return l.PF.interpreter(a.left)(b)!=l.PF.interpreter(a.right)(b);case"MOD":return l.PF.interpreter(a.left)(b)%l.PF.interpreter(a.right)(b);case"VAR":return b;case"NUM":return a.val;default:throw new Error("Invalid Token found.")}}},l.PF.extractPluralExpr=function(a){a=a.replace(/^\s\s*/,"").replace(/\s\s*$/,""),/;\s*$/.test(a)||(a=a.concat(";"));var b,c=/nplurals\=(\d+);/,d=/plural\=(.*);/,e=a.match(c),f={};if(!(e.length>1))throw new Error("nplurals not found in plural_forms string: "+a);if(f.nplurals=e[1],a=a.replace(c,""),b=a.match(d),!(b&&b.length>1))throw new Error("`plural` expression not found: "+a);return b[1]},l.PF.parser=function(){var a={trace:function(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,"?":6,":":7,"||":8,"&&":9,"<":10,"<=":11,">":12,">=":13,"!=":14,"==":15,"%":16,"(":17,")":18,n:19,NUMBER:20,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"?",7:":",8:"||",9:"&&",10:"<",11:"<=",12:">",13:">=",14:"!=",15:"==",16:"%",17:"(",18:")",19:"n",20:"NUMBER"},productions_:[0,[3,2],[4,5],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1]],performAction:function(a,b,c,d,e,f){var g=f.length-1;switch(e){case 1:return{type:"GROUP",expr:f[g-1]};case 2:this.$={type:"TERNARY",expr:f[g-4],truthy:f[g-2],falsey:f[g]};break;case 3:this.$={type:"OR",left:f[g-2],right:f[g]};break;case 4:this.$={type:"AND",left:f[g-2],right:f[g]};break;case 5:this.$={type:"LT",left:f[g-2],right:f[g]};break;case 6:this.$={type:"LTE",left:f[g-2],right:f[g]};break;case 7:this.$={type:"GT",left:f[g-2],right:f[g]};break;case 8:this.$={type:"GTE",left:f[g-2],right:f[g]};break;case 9:this.$={type:"NEQ",left:f[g-2],right:f[g]};break;case 10:this.$={type:"EQ",left:f[g-2],right:f[g]};break;case 11:this.$={type:"MOD",left:f[g-2],right:f[g]};break;case 12:this.$={type:"GROUP",expr:f[g-1]};break;case 13:this.$={type:"VAR"};break;case 14:this.$={type:"NUM",val:Number(a)}}},table:[{3:1,4:2,17:[1,3],19:[1,4],20:[1,5]},{1:[3]},{5:[1,6],6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{4:17,17:[1,3],19:[1,4],20:[1,5]},{5:[2,13],6:[2,13],7:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],18:[2,13]},{5:[2,14],6:[2,14],7:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],18:[2,14]},{1:[2,1]},{4:18,17:[1,3],19:[1,4],20:[1,5]},{4:19,17:[1,3],19:[1,4],20:[1,5]},{4:20,17:[1,3],19:[1,4],20:[1,5]},{4:21,17:[1,3],19:[1,4],20:[1,5]},{4:22,17:[1,3],19:[1,4],20:[1,5]},{4:23,17:[1,3],19:[1,4],20:[1,5]},{4:24,17:[1,3],19:[1,4],20:[1,5]},{4:25,17:[1,3],19:[1,4],20:[1,5]},{4:26,17:[1,3],19:[1,4],20:[1,5]},{4:27,17:[1,3],19:[1,4],20:[1,5]},{6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[1,28]},{6:[1,7],7:[1,29],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{5:[2,3],6:[2,3],7:[2,3],8:[2,3],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,3]},{5:[2,4],6:[2,4],7:[2,4],8:[2,4],9:[2,4],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,4]},{5:[2,5],6:[2,5],7:[2,5],8:[2,5],9:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],14:[2,5],15:[2,5],16:[1,16],18:[2,5]},{5:[2,6],6:[2,6],7:[2,6],8:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],14:[2,6],15:[2,6],16:[1,16],18:[2,6]},{5:[2,7],6:[2,7],7:[2,7],8:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],14:[2,7],15:[2,7],16:[1,16],18:[2,7]},{5:[2,8],6:[2,8],7:[2,8],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[2,8],16:[1,16],18:[2,8]},{5:[2,9],6:[2,9],7:[2,9],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[1,16],18:[2,9]},{5:[2,10],6:[2,10],7:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[1,16],18:[2,10]},{5:[2,11],6:[2,11],7:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],18:[2,11]},{5:[2,12],6:[2,12],7:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],18:[2,12]},{4:30,17:[1,3],19:[1,4],20:[1,5]},{5:[2,2],6:[1,7],7:[2,2],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,2]}],defaultActions:{6:[2,1]},parseError:function(a){throw new Error(a)},parse:function(a){function b(a){e.length=e.length-2*a,f.length=f.length-a,g.length=g.length-a}function c(){var a;return a=d.lexer.lex()||1,"number"!=typeof a&&(a=d.symbols_[a]||a),a}var d=this,e=[0],f=[null],g=[],h=this.table,i="",j=0,k=0,l=0,m=2,n=1;this.lexer.setInput(a),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var o=this.lexer.yylloc;g.push(o),"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var p,q,r,s,t,u,v,w,x,y={};;){if(r=e[e.length-1],this.defaultActions[r]?s=this.defaultActions[r]:(null==p&&(p=c()),s=h[r]&&h[r][p]),"undefined"==typeof s||!s.length||!s[0]){if(!l){x=[];for(u in h[r])this.terminals_[u]&&u>2&&x.push("'"+this.terminals_[u]+"'");var z="";z=this.lexer.showPosition?"Parse error on line "+(j+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+x.join(", ")+", got '"+this.terminals_[p]+"'":"Parse error on line "+(j+1)+": Unexpected "+(1==p?"end of input":"'"+(this.terminals_[p]||p)+"'"),this.parseError(z,{text:this.lexer.match,token:this.terminals_[p]||p,line:this.lexer.yylineno,loc:o,expected:x})}if(3==l){if(p==n)throw new Error(z||"Parsing halted.");k=this.lexer.yyleng,i=this.lexer.yytext,j=this.lexer.yylineno,o=this.lexer.yylloc,p=c()}for(;;){if(m.toString()in h[r])break;if(0==r)throw new Error(z||"Parsing halted.");b(1),r=e[e.length-1]}q=p,p=m,r=e[e.length-1],s=h[r]&&h[r][m],l=3}if(s[0]instanceof Array&&s.length>1)throw new Error("Parse Error: multiple actions possible at state: "+r+", token: "+p);switch(s[0]){case 1:e.push(p),f.push(this.lexer.yytext),g.push(this.lexer.yylloc),e.push(s[1]),p=null,q?(p=q,q=null):(k=this.lexer.yyleng,i=this.lexer.yytext,j=this.lexer.yylineno,o=this.lexer.yylloc,l>0&&l--);break;case 2:if(v=this.productions_[s[1]][1],y.$=f[f.length-v],y._$={first_line:g[g.length-(v||1)].first_line,last_line:g[g.length-1].last_line,first_column:g[g.length-(v||1)].first_column,last_column:g[g.length-1].last_column},t=this.performAction.call(y,i,k,j,this.yy,s[1],f,g),"undefined"!=typeof t)return t;v&&(e=e.slice(0,2*-1*v),f=f.slice(0,-1*v),g=g.slice(0,-1*v)),e.push(this.productions_[s[1]][0]),f.push(y.$),g.push(y._$),w=h[e[e.length-2]][e[e.length-1]],e.push(w);break;case 3:return!0}}return!0}},b=function(){var a={EOF:1,parseError:function(a,b){if(!this.yy.parseError)throw new Error(a);this.yy.parseError(a,b)},setInput:function(a){return this._input=a,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.match+=a,this.matched+=a;var b=a.match(/\n/);return b&&this.yylineno++,this._input=this._input.slice(1),a},unput:function(a){return this._input=a+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=new Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c;this._more||(this.yytext="",this.match="");for(var d=this._currentRules(),e=0;e<d.length;e++)if(b=this._input.match(this.rules[d[e]]))return c=b[0].match(/\n.*/g),c&&(this.yylineno+=c.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:c?c[c.length-1].length-1:this.yylloc.last_column+b[0].length},this.yytext+=b[0],this.match+=b[0],this.matches=b,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(b[0].length),this.matched+=b[0],a=this.performAction.call(this,this.yy,this,d[e],this.conditionStack[this.conditionStack.length-1]),a?a:void 0;
return""===this._input?this.EOF:(this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno}),void 0)},lex:function(){var a=this.next();return"undefined"!=typeof a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(a){this.begin(a)}};return a.performAction=function(a,b,c,d){switch(c){case 0:break;case 1:return 20;case 2:return 19;case 3:return 8;case 4:return 9;case 5:return 6;case 6:return 7;case 7:return 11;case 8:return 13;case 9:return 10;case 10:return 12;case 11:return 14;case 12:return 15;case 13:return 16;case 14:return 17;case 15:return 18;case 16:return 5;case 17:return"INVALID"}},a.rules=[/^\s+/,/^[0-9]+(\.[0-9]+)?\b/,/^n\b/,/^\|\|/,/^&&/,/^\?/,/^:/,/^<=/,/^>=/,/^</,/^>/,/^!=/,/^==/,/^%/,/^\(/,/^\)/,/^$/,/^./],a.conditions={INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],inclusive:!0}},a}();return a.lexer=b,a}(),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=l),exports.Jed=l):("function"==typeof define&&define.amd&&define("jed",function(){return l}),a.Jed=l)}(this);